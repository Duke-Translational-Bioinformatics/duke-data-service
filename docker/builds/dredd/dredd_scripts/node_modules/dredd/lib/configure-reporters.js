// Generated by CoffeeScript 1.10.0
var ApiaryReporter, BaseReporter, CliReporter, DotReporter, HtmlReporter, MarkdownReporter, NyanCatReporter, XUnitReporter, cliReporters, configureReporters, fileReporters, intersection, logger,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

BaseReporter = require('./reporters/base-reporter');

XUnitReporter = require('./reporters/x-unit-reporter');

CliReporter = require('./reporters/cli-reporter');

DotReporter = require('./reporters/dot-reporter');

NyanCatReporter = require('./reporters/nyan-reporter');

HtmlReporter = require('./reporters/html-reporter');

MarkdownReporter = require('./reporters/markdown-reporter');

ApiaryReporter = require('./reporters/apiary-reporter');

logger = require('./logger');

fileReporters = ['junit', 'html', 'markdown', 'apiary'];

cliReporters = ['dot', 'nyan'];

intersection = function(a, b) {
  var j, len, ref, results, value;
  if (a.length > b.length) {
    ref = [b, a], a = ref[0], b = ref[1];
  }
  results = [];
  for (j = 0, len = a.length; j < len; j++) {
    value = a[j];
    if (indexOf.call(b, value) >= 0) {
      results.push(value);
    }
  }
  return results;
};

configureReporters = function(config, stats, tests, runner) {
  var addCli, addReporter, baseReporter, i, j, len, outputs, path, reporter, reporters, results, usedFileReporters, usedFileReportersLength;
  baseReporter = new BaseReporter(config.emitter, stats, tests);
  reporters = config.options.reporter;
  outputs = config.options.output;
  addCli = function(reporters) {
    var cliReporter, usedCliReporters;
    if (reporters.length > 0) {
      usedCliReporters = intersection(reporters, cliReporters);
      if (usedCliReporters.length === 0) {
        return cliReporter = new CliReporter(config.emitter, stats, tests, config.options['inline-errors'], config.options.details);
      } else {
        return addReporter(usedCliReporters[0], config.emitter, stats, tests);
      }
    } else {
      return cliReporter = new CliReporter(config.emitter, stats, tests, config.options['inline-errors'], config.options.details);
    }
  };
  addReporter = function(reporter, emitter, stats, tests, path) {
    var apiaryReporter, dotReporter, htmlReporter, mdReporter, nyanCatReporter, xUnitReporter;
    switch (reporter) {
      case 'junit':
        return xUnitReporter = new XUnitReporter(emitter, stats, tests, path, config.options.details);
      case 'dot':
        return dotReporter = new DotReporter(emitter, stats, tests);
      case 'nyan':
        return nyanCatReporter = new NyanCatReporter(emitter, stats, tests);
      case 'html':
        return htmlReporter = new HtmlReporter(emitter, stats, tests, path, config.options.details);
      case 'markdown':
        return mdReporter = new MarkdownReporter(emitter, stats, tests, path, config.options.details);
      case 'apiary':
        return apiaryReporter = new ApiaryReporter(emitter, stats, tests, config, runner);
    }
  };
  if (!config.options.silent) {
    addCli(reporters);
  }
  usedFileReporters = intersection(reporters, fileReporters);
  stats.fileBasedReporters = usedFileReporters.length;
  if (usedFileReporters.length > 0) {
    usedFileReportersLength = usedFileReporters.length;
    if (reporters.indexOf('apiary') > -1) {
      usedFileReportersLength = usedFileReportersLength - 1;
    }
    if (usedFileReportersLength > outputs.length) {
      logger.warn("There are more reporters requiring output paths than there are output paths provided, using default paths for additional file-based reporters.");
    }
    results = [];
    for (i = j = 0, len = usedFileReporters.length; j < len; i = ++j) {
      reporter = usedFileReporters[i];
      path = outputs[i] ? outputs[i] : null;
      results.push(addReporter(reporter, config.emitter, stats, tests, path));
    }
    return results;
  }
};

module.exports = configureReporters;
